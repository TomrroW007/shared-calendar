# Shared Calendar 产品需求文档 (PRD)

## 1. 项目背景与目标
### 1.1 背景
在家庭、小型团队或社交圈子中，协调多人的日程安排往往比较繁琐。现有的日历软件（如 Google Calendar, Outlook）功能强大但相对重头，且在“寻找共同空闲时间”和“非正式状态分享”方面不够轻便。

### 1.2 目标
打造一个轻量级的共享日历应用，专注于：
- **状态共享**：快速同步成员的忙碌、休假或待定状态。
- **协同决策**：通过投票机制快速确定集体活动的时间。
- **实时同步**：多人在同一空间内操作，状态实时更新。

---

## 2. 核心功能（已实现）
### 2.1 用户与认证
- **匿名注册**：用户只需设置昵称即可开始使用，通过 Token 进行持久化认证。
- **个性化**：支持设置头像颜色。

### 2.2 空间管理 (Spaces)
- **空间创建**：用户可以创建多个独立的共享空间（如“家人”、“球友”）。
- **邀请加入**：通过 6 位大写字母/数字邀请码邀请成员加入。
- **角色管理**：支持管理员 (Admin) 和普通成员 (Member) 两种角色。

### 2.3 共享日历 (Shared Calendar)
- **月视图显示**：直观展示当月日程，整合中国法定节假日和调休信息（2025-2027）。
- **状态标记**：用户可以在日历上标记自己的状态（忙碌、休假、空闲、待定）。
- **隐私控制**：支持公开、私人（仅显示忙碌）、仅显示状态三种可见性。

### 2.4 活动提案与投票 (Proposals)
- **发起提案**：发起人可提供多个日期候选。
- **多准则投票**：成员可对每个日期标记“有空”、“没空”或“待定”。
- **决策确认**：发起人可根据投票结果确认最终日期。

### 2.5 实时通知与同步
- **SSE 实时更新**：基于 Server-Sent Events 实现数据的准实时刷新。
- **通知中心**：记录活动邀请、投票提醒等消息。

---

## 3. 设计改进与完善（基于同类产品调研）
通过对比 Google Calendar, TimeTree, Doodle 等软件，识别出当前版本的改进点：

### 3.1 核心日历与排程增强

- **[高] 重复事件支持 (Recurring Events)**：

    - 支持日、周、月、年及自定义重复（如：每月最后一个周五）。

    - 需实现“修改单个事件”或“修改所有后续事件”的逻辑。

- **[中] 多维度视图 (Multi-dimensional Views)**：

    - **垂直列表视图 (Vertical/Agenda View)**：模仿 TimeTree，方便移动端快速浏览。

    * **热力图视图 (Heatmap)**：展示空间内成员活跃度，辅助寻找“最闲”日期。

- **[高] 冲突检测与自动纠错 (Conflict & Correction)**：

    - 实时冲突警告。

    - **自动缩减 (Speedy Meetings)**：模仿 Google Calendar，允许设置默认缩短 5-10 分钟以预留休息时间。



### 3.2 协同决策与沟通 (借鉴 TimeTree & Doodle)

- **[高] 事件聊天室 (Event-specific Chat)**：

    - 每个 Event 或 Proposal 自动关联一个小型聊天频道，支持留言和图片上传。

- **[高] 匿名投票与偏好等级 (Advanced Polling)**：

    - 模仿 Doodle，支持“不可见投票”（仅发起人可见结果）及偏好标记（“如果必须可以”、“优先选择”）。

- **[中] 外部预约链接 (Public Booking Page)**：

    - 借鉴 Calendly，允许用户生成一个基于自己空闲时间的公共预约链接，外部人员无需注册即可预约。



### 3.3 通知与提醒机制

- **[高] 多级提醒 (Multi-level Alerts)**：

    - 支持多次提醒（如：1天前、1小时前、15分钟前）。

- **[中] 状态变更推送**：

    - 当空间内有成员标记“休假”或修改日程时，实时推送通知给相关人员。



### 3.4 架构与数据增强

- **[高] 附件支持 (Attachments)**：

    - 支持在日程中上传文件或图片（如会议议程 PDF、聚会地点图片）。

- **[高] 国际化与时区转换 (Timezone)**：

    - 针对跨时区团队，提供自动时间转换功能，确保显示的时间为用户当地时间。

- **[低] 第三方集成 (Integrations)**：

    - 预留 Slack/Discord Webhook 接口，在空间发生变动时同步到沟通工具。



---

## 4. 技术栈
- **前端**：Next.js (App Router), React, CSS Modules.
- **后端**：Next.js Route Handlers.
- **数据库**：MongoDB (主要), SQLite (备选/Schema定义).
- **实时通信**：Server-Sent Events (SSE).

---

## 5. 数据模型建议 (更新)
为了支持上述改进，建议对 `models/index.js` 进行如下扩展：
- **Event**: 增加 `recurrence_rule`, `timezone`, `location` 字段。
- **Space**: 增加 `timezone_default` 字段。
- **Comment**: 新增模型，关联 `event_id` 或 `proposal_id`。
